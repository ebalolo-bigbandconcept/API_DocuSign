openapi: 3.0.4
info:
  title: Docusign eSign REST API
  description: Cette API vous permet d'envoyer des PDFs aux clients via DocuSign eSign et de recevoir des notifications webhook.
  version: 2.0.0
servers:
  - url: http://195.110.34.168:5001/api/
  - url: http://localhost:5001/api/
tags:
  - name: pdf
    description: Utiliser l'API REST docusign esign pour envoyer un PDF au client
  - name: webhook
    description: Gestion des webhooks et notifications DocuSign
  - name: tracking
    description: Suivi des enveloppes
externalDocs:
  description: Github
  url: https://github.com/ebalolo-bigbandconcept/API_DocuSign
paths:
  /send-pdf:
    post:
      tags:
        - pdf
      summary: Envoyer un PDF à un client spécifié avec notification webhook
      operationId: sendPdf
      requestBody:
        content:
          multipart/form-data:
            schema:
              $ref: '#/components/schemas/Send-pdf'
        required: true

      responses:
        '200':
          description: Opération réussie
          content:
            application/json:
              schema:
                type: object
                properties:
                  envelope_id:
                    type: string
                    example: "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
                  webhook_url:
                    type: string
                    example: "http://localhost:5001/api/webhook/docusign"
                  tracking_id:
                    type: integer
                    example: 1
        '400':
          description: Données ou fichier manquants
        '500':
          description: Erreur DocuSign
  
  /webhook/docusign:
    post:
      tags:
        - webhook
      summary: Endpoint webhook pour recevoir les notifications DocuSign
      description: Cet endpoint reçoit automatiquement les notifications de DocuSign lorsque l'état d'une enveloppe change
      operationId: docusignWebhook
      requestBody:
        content:
          application/xml:
            schema:
              type: string
          application/json:
            schema:
              $ref: '#/components/schemas/WebhookPayload'
      responses:
        '200':
          description: Webhook traité avec succès
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "processed"
                  envelope_id:
                    type: string
                    example: "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
        '500':
          description: Erreur lors du traitement du webhook
  
  /envelope/{envelope_id}/status:
    get:
      tags:
        - tracking
      summary: Obtenir le statut d'une enveloppe
      operationId: getEnvelopeStatus
      parameters:
        - name: envelope_id
          in: path
          required: true
          schema:
            type: string
          description: ID de l'enveloppe DocuSign
      responses:
        '200':
          description: Statut de l'enveloppe
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnvelopeTracking'
        '404':
          description: Enveloppe non trouvée
  
  /envelopes:
    get:
      tags:
        - tracking
      summary: Liste toutes les enveloppes suivies
      operationId: listEnvelopes
      responses:
        '200':
          description: Liste des enveloppes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EnvelopeTracking'

components:
  schemas:
    Send-pdf:
      required:
        - file
        - signers
        - integrator_key
        - user_id
        - account_id
        - callback_url
      type: object
      properties:
        file:
          type: string
          format: binary
          example: document.pdf
        signers:
          type: array
          items:
            type: object
            properties:
              email:
                type: string
                example: example@gmail.com
              name:
                type: string
                example: Nom Prénom
        integrator_key:
          type: string
          example: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
        user_id:
          type: string
          example: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
        account_id:
          type: string
          example: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
        callback_url:
          type: string
          format: uri
          example: https://votre-site.com/api/docusign-callback
          description: URL où recevoir les notifications lorsque l'enveloppe est signée
    
    WebhookPayload:
      type: object
      properties:
        envelope_id:
          type: string
          example: "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
        status:
          type: string
          enum: [completed, declined, voided]
          example: "completed"
    
    EnvelopeTracking:
      type: object
      properties:
        id:
          type: integer
          example: 1
        envelope_id:
          type: string
          example: "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx"
        callback_url:
          type: string
          example: "https://votre-site.com/api/docusign-callback"
        requester_host:
          type: string
          example: "https://external-site.com"
        status:
          type: string
          example: "completed"
        created_at:
          type: string
          format: date-time
          example: "2025-12-16T10:30:00"
        signed_at:
          type: string
          format: date-time
          example: "2025-12-16T12:45:30"
        notified_at:
          type: string
          format: date-time
          example: "2025-12-16T12:45:35"
        notification_status:
          type: string
          example: "success_200"

  securitySchemes:
    api_key:
      type: apiKey
      in: header
      name: api_key